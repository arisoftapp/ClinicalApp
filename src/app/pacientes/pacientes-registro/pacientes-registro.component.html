<div class="row">
  <div class="title-row">
    <h2>{{funcion}}</h2>
  </div>
</div>

<mat-card class="medic-card">
  <mat-card-header>
    <mat-card-subtitle>Datos generales</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <div>
      <mat-form-field appearance="outline" style="width: 300px" >
        <mat-label>Nombre</mat-label>
        <input matInput [(ngModel)]="paciente.nombre"  required cdkFocusInitial [formControl]="nombre_fc"
        [errorStateMatcher]="matcher">
        <mat-error *ngIf="nombre_fc.hasError('required')">
            Este campo es <strong>obligatorio</strong>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 250px" >
        <mat-label>Apellido paterno</mat-label>
        <input matInput [(ngModel)]="paciente.ap_paterno" required [formControl]="apaterno_fc"
        [errorStateMatcher]="matcher">
        <mat-error *ngIf="apaterno_fc.hasError('required')">
          Este campo es <strong>obligatorio</strong>
      </mat-error>
      </mat-form-field>            
      <mat-form-field appearance="outline" style="width: 250px">
        <mat-label>Apellido materno</mat-label>
        <input matInput [(ngModel)]="paciente.ap_materno" required [formControl]="amaterno_fc"
        [errorStateMatcher]="matcher">
        <mat-error *ngIf="amaterno_fc.hasError('required')">
          Este campo es <strong>obligatorio</strong>
      </mat-error>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline" style="width: 250px" >
        <mat-label>Fecha de nacimiento</mat-label>
        <input matInput [matDatepicker]="fecha_nac" [(ngModel)]="paciente.fecha_nac" disabled required>
        <mat-datepicker-toggle matSuffix [for]="fecha_nac"></mat-datepicker-toggle>
        <mat-datepicker #fecha_nac disabled="false"></mat-datepicker>
      </mat-form-field>
    </div>
    <div>
      <label class="row-item" >Sexo:</label>
      <mat-radio-group aria-label="Sexo" [(ngModel)]="paciente.sexo" required>
        <mat-radio-button value="1" class="row-item" [checked]="paciente.sexo === '1'"  >Masculino</mat-radio-button>
        <mat-radio-button value="2" class="row-item">Femenino</mat-radio-button>
      </mat-radio-group>
    </div>
  </mat-card-content>
</mat-card>
<!-- ******* DOMICILIO ******* -->
<mat-card class="medic-card">
  <mat-card-header>
    <mat-card-subtitle>Domicilio</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <div>
      <mat-form-field appearance="outline" style="width: 300px">
        <mat-label>Calle</mat-label>
        <input matInput [(ngModel)]="paciente.calle">
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 100px">
        <mat-label>No. exterior</mat-label>
        <input matInput [(ngModel)]="paciente.no_ext" [formControl]="noext_fc"
        [errorStateMatcher]="matcher">
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 100px">
        <mat-label>No. interior</mat-label>
        <input matInput [(ngModel)]="paciente.no_int" [formControl]="noint_fc"
        [errorStateMatcher]="matcher">
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 300px">
        <mat-label>Localidad</mat-label>
        <input matInput [(ngModel)]="paciente.ciudad">
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 300px">
        <mat-label>Colonia</mat-label>
        <input matInput [(ngModel)]="paciente.colonia">
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline" style="width: 300px">
        <mat-label>Estado</mat-label>
        <mat-select [(value)]="paciente.id_estado" #entidad (selectionChange)='getMunicipios(entidad.value)'>
          <mat-option *ngFor="let estado of Estados" [value]="estado.id_estado">
            {{estado.nombre_estado}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 300px">
        <mat-label>Municipio</mat-label>
        <mat-select [(value)]="paciente.id_municipio">
          <mat-option *ngFor="let mun of Municipios" [value]="mun.id_municipio">
            {{mun.nombre_municipio}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card-content>
</mat-card>
<!-- ******* CONTACTO ******* -->
<mat-card class="medic-card">
  <mat-card-header>
    <mat-card-subtitle>Contacto</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <div>
      <mat-form-field appearance="outline" style="width: 400px">
        <mat-label>Correo electrónico</mat-label>
        <input matInput [(ngModel)]="paciente.email" required [formControl]="email"
        [errorStateMatcher]="matcher">
        <mat-error *ngIf="email.hasError('email') && email.hasError('required')">
          Ingrese una dirección de correo válida
        </mat-error>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline" style="width: 300px">
        <mat-label>Teléfono</mat-label>
        <input matInput [(ngModel)]="paciente.tel_fijo" required [formControl]="telefono_fc"
        [errorStateMatcher]="matcher" maxlength="10">
        <mat-hint align="end" >{{paciente.tel_fijo.length}} / 10</mat-hint>
        <mat-error *ngIf="telefono_fc.hasError('required') || celular_fc.value?.length < 7">
          Ingrese un número telefónico válido
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 300px">
        <mat-label>Celular</mat-label>
        <input matInput [(ngModel)]="paciente.tel_cel"  required [formControl]="celular_fc"
        [errorStateMatcher]="matcher" maxlength="10">
        <mat-hint align="end" >{{paciente.tel_cel.length}} / 10</mat-hint>
        <mat-error *ngIf="celular_fc.hasError('required') || celular_fc.value?.length < 10">
          Ingrese un número telefónico válido
      </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" style="width: 300px">
        <mat-label>Teléfono adicional</mat-label>
        <input matInput [(ngModel)]="paciente.tel_alter" [formControl]="adicional_fc"
        [errorStateMatcher]="matcher" maxlength="10">
        <mat-hint align="end" >{{paciente.tel_alter.length}} / 10</mat-hint>
      </mat-form-field>
    </div>
  </mat-card-content>
</mat-card>
<!-- ******* INFORMACIÓN MÉDICA ******* -->
<mat-card class="medic-card">
    <mat-card-header>
      <mat-card-subtitle>Información médica</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div>
        <mat-form-field appearance="outline" style="width: 150px">
          <mat-label>Grupo sanguineo</mat-label>
          <input matInput [(ngModel)]="paciente.tipo_sangre">
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline" style="width: 300px">
          <mat-label>Alergias</mat-label>
          <textarea matInput [(ngModel)]="paciente.alergias"></textarea>
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 300px">
          <mat-label>Enfermedades crónicas</mat-label>
          <textarea matInput [(ngModel)]="paciente.cronicas"></textarea>
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 300px">
          <mat-label>Anotaciones</mat-label>
          <textarea matInput [(ngModel)]="paciente.anotacion"></textarea>
        </mat-form-field>
      </div>
    </mat-card-content>
</mat-card>

<!--  ******* FACTURACION ******-->
<mat-expansion-panel (opened)="paciente.datos_fact = 0" (closed)="paciente.datos_fact = 1" class="medic-card">
  <mat-expansion-panel-header>
    <mat-slide-toggle [checked]="paciente.datos_fact === 1" disabled style="opacity: 1;">
      Utilizar datos del paciente como datos de facturación
    </mat-slide-toggle>
  </mat-expansion-panel-header>
  <div class="space">
    <label class="row-item" >Persona:</label>
    <mat-radio-group aria-label="Razon" [(ngModel)]="paciente.fact_persona" required>
      <mat-radio-button value="1" class="row-item" [checked]="paciente.fact_persona === '1'"  >Física</mat-radio-button>
      <mat-radio-button value="2" class="row-item">Moral</mat-radio-button>
    </mat-radio-group>
  </div>
  <mat-form-field appearance="outline" style="width: 300px">
      <mat-label>Razón social</mat-label>
      <input matInput [(ngModel)]="paciente.fact_razonsoc" required 
      [errorStateMatcher]="matcher">
    </mat-form-field>
    <mat-form-field appearance="outline" style="width: 300px">
        <mat-label>RFC</mat-label>
        <input matInput [(ngModel)]="paciente.tel_fijo" required [formControl]="telefono_fc"
        [errorStateMatcher]="matcher">
        <mat-hint *ngIf="paciente.fact_persona === '1'" align="end" >{{paciente.tel_fijo.length}} / 13</mat-hint>
        <mat-hint *ngIf="paciente.fact_persona === '2'" align="end" >{{paciente.tel_fijo.length}} / 12</mat-hint>
    </mat-form-field>
    
    <div>
        <mat-form-field appearance="outline" style="width: 300px">
          <mat-label>Calle</mat-label>
          <input matInput [(ngModel)]="paciente.fact_calle">
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 100px">
          <mat-label>No. exterior</mat-label>
          <input matInput [(ngModel)]="paciente.fact_ext" [formControl]="noext_fc"
          [errorStateMatcher]="matcher">
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 100px">
          <mat-label>No. interior</mat-label>
          <input matInput [(ngModel)]="paciente.fact_int" [formControl]="noint_fc"
          [errorStateMatcher]="matcher">
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 300px">
          <mat-label>Localidad</mat-label>
          <input matInput [(ngModel)]="paciente.fact_colonia">
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 200px">
          <mat-label>Código postal</mat-label>
          <input matInput [(ngModel)]="paciente.fact_cp" required 
          [errorStateMatcher]="matcher" maxlength="5">
          <mat-hint align="end" >{{paciente.fact_cp.length}} / 5</mat-hint>
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline" style="width: 300px">
          <mat-label>Estado</mat-label>
          <mat-select [(value)]="paciente.fact_idedo" #fact_entidad (selectionChange)='getFactMunicipios(fact_entidad.value)'>
            <mat-option *ngFor="let estado of Estados" [value]="estado.id_estado">
              {{estado.nombre_estado}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 300px">
          <mat-label>Municipio</mat-label>
          <mat-select [(value)]="paciente.fact_idmun">
            <mat-option *ngFor="let mun of Fact_municipios" [value]="mun.id_municipio">
              {{mun.nombre_municipio}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline" style="width: 400px">
          <mat-label>Correo electrónico</mat-label>
          <input matInput [(ngModel)]="paciente.fact_email" required [formControl]="fact_email"
          [errorStateMatcher]="matcher">
          <mat-error *ngIf="fact_email.hasError('email') && fact_email.hasError('required')">
            Ingrese una dirección de correo válida
          </mat-error>
        </mat-form-field>
      </div>
</mat-expansion-panel>
  

<!--  ******* OPCIONES ******-->
<mat-card class="medic-card">
    <mat-card-content>
      <div style="text-align: right;">
          <button mat-button>Cancelar</button>
          <button mat-button color="primary" (click)="onSubmit()" >Guardar</button>
      </div>
    </mat-card-content>
  </mat-card>